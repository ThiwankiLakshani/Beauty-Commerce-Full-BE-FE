{% extends "base.html" %}
{% block title %}Users â€” Admin{% endblock %}
{% block content %}
  <div class="bg-white/95 backdrop-blur shadow-soft border border-emerald-50 rounded-2xl p-6">

    <!-- Header -->
    <div class="flex items-center justify-between gap-3">
      <h1 class="text-2xl font-bold text-slate-800">Users</h1>
      <div class="flex items-center gap-2">
        <a class="inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-white bg-emerald-600 hover:bg-emerald-700 focus-visible:ring-2 focus-visible:ring-emerald-300 transition"
           href="{{ url_for('users_new') }}">
          <!-- plus icon -->
          <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/></svg>
          Create User
        </a>
      </div>
    </div>

    <!-- Filters -->
    <form class="mt-5 grid grid-cols-1 md:grid-cols-5 gap-3">
      <div class="md:col-span-2">
        <div class="relative">
          <span class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
            <!-- search icon -->
            <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.9 14.32a7 7 0 111.414-1.414l3.387 3.386a1 1 0 01-1.414 1.415l-3.387-3.387zM14 8a6 6 0 11-12 0 6 6 0 0112 0z" clip-rule="evenodd"/></svg>
          </span>
          <input type="text" name="q" value="{{ q }}" placeholder="Search name or email"
                 class="w-full pl-9 pr-3 py-2.5 rounded-xl border border-slate-200 bg-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-300 focus:border-emerald-400 transition" />
        </div>
      </div>

      <div>
        <div class="relative">
          <span class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
            <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="currentColor"><path d="M6 3a3 3 0 00-3 3v1h14V6a3 3 0 00-3-3H6z"/><path d="M3 9h14v5a3 3 0 01-3 3H6a3 3 0 01-3-3V9z"/></svg>
          </span>
          <select name="role"
                  class="w-full pl-9 pr-8 py-2.5 rounded-xl border border-slate-200 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-300 focus:border-emerald-400 transition">
            <option value="">All roles</option>
            <option value="user"  {% if role=='user' %}selected{% endif %}>User</option>
            <option value="admin" {% if role=='admin' %}selected{% endif %}>Admin</option>
          </select>
        </div>
      </div>

      <div>
        <div class="relative">
          <span class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
            <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a8 8 0 100 16 8 8 0 000-16z"/><path d="M10 6a1 1 0 011 1v3.382l2.447 1.632a1 1 0 11-1.11 1.664l-3-2A1 1 0 019 11V7a1 1 0 011-1z" fill="white" opacity=".7"/></svg>
          </span>
          <select name="status"
                  class="w-full pl-9 pr-8 py-2.5 rounded-xl border border-slate-200 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-300 focus:border-emerald-400 transition">
            <option value="">All statuses</option>
            <option value="active"   {% if status=='active' %}selected{% endif %}>Active</option>
            <option value="inactive" {% if status=='inactive' %}selected{% endif %}>Inactive</option>
          </select>
        </div>
      </div>

      <div class="flex items-stretch gap-2">
        <button class="w-full md:w-auto px-4 py-2.5 rounded-xl font-semibold text-white bg-emerald-600 hover:bg-emerald-700 focus-visible:ring-2 focus-visible:ring-emerald-300 transition">
          Filter
        </button>
        <a href="{{ url_for('users_list') }}"
           class="hidden md:inline-flex items-center px-3 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-700 hover:bg-slate-50">
          Reset
        </a>
      </div>
    </form>

    <!-- Table -->
    <div class="mt-5 overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="text-left text-slate-500">
          <tr class="border-b border-slate-100">
            <th class="py-2.5 pr-4">Name</th>
            <th class="py-2.5 pr-4">Email</th>
            <th class="py-2.5 pr-4">Role</th>
            <th class="py-2.5 pr-4">Status</th>
            <th class="py-2.5 pr-4">Created</th>
            <th class="py-2.5 pr-4">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for u in users %}
            <tr class="hover:bg-slate-50/60">
              <td class="py-2.5 pr-4">
                <a class="inline-flex items-center gap-3 group"
                   href="{{ url_for('users_show', user_id=u._id) }}">
                  <!-- avatar -->
                  <span class="h-8 w-8 rounded-full bg-emerald-600/10 text-emerald-700 grid place-items-center text-xs font-semibold">
                    {{ (u.name or 'U')[:1] }}
                  </span>
                  <span class="group-hover:underline decoration-emerald-400 underline-offset-2 font-medium text-slate-800">
                    {{ u.name }}
                  </span>
                </a>
              </td>
              <td class="py-2.5 pr-4 text-slate-700">{{ u.email }}</td>
              <td class="py-2.5 pr-4">
                {% set _role = (u.role or 'user') %}
                <span class="px-2.5 py-1 rounded-full text-xs font-medium
                  {% if _role == 'admin' %} bg-emerald-100 text-emerald-800
                  {% else %} bg-slate-100 text-slate-700 {% endif %}">
                  {{ _role|capitalize }}
                </span>
              </td>
              <td class="py-2.5 pr-4">
                {% if u.is_active %}
                  <span class="px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">Active</span>
                {% else %}
                  <span class="px-2.5 py-1 rounded-full text-xs font-medium bg-slate-200 text-slate-700">Inactive</span>
                {% endif %}
              </td>
              <td class="py-2.5 pr-4 text-slate-700">{{ (u.created_at)|dt }}</td>
              <td class="py-2.5 pr-4">
                <a class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-slate-200 bg-white text-slate-700 hover:bg-slate-50"
                   href="{{ url_for('users_edit', user_id=u._id) }}">
                  <!-- pencil icon -->
                  <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793z"/><path d="M4 13.5V16h2.5l7.086-7.086-2.5-2.5L4 13.5z"/></svg>
                  Edit
                </a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" class="py-10">
                <div class="flex flex-col items-center justify-center text-center">
                  <div class="h-12 w-12 rounded-2xl bg-emerald-600/10 flex items-center justify-center mb-3">
                    <!-- users icon -->
                    <svg class="w-6 h-6 text-emerald-700" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10a4 4 0 118 0 4 4 0 01-8 0z"/><path d="M4 20a8 8 0 1116 0H4z"/></svg>
                  </div>
                  <p class="text-slate-700 font-medium">No users found</p>
                  <p class="text-slate-500 text-sm">Try adjusting your filters or create a new user.</p>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% include "_pagination.html" %}
  </div>
{% endblock %}
